[gd_scene load_steps=9 format=3 uid="uid://t3vnm1lbpphd"]

[ext_resource type="PackedScene" uid="uid://cwqowh0kgiels" path="res://Scenes/UI/combat_player_ui.tscn" id="1_7uj85"]
[ext_resource type="PackedScene" uid="uid://cf11t36eqnirk" path="res://Scenes/player_character.tscn" id="2_2ip8y"]
[ext_resource type="PackedScene" uid="uid://crmeup0pjy7wf" path="res://Scenes/enemy_character.tscn" id="3_vtehv"]
[ext_resource type="PackedScene" uid="uid://dxvjktdaf834m" path="res://Scenes/combat_manager.tscn" id="4_loea4"]
[ext_resource type="Script" uid="uid://dhlx803nye16j" path="res://Scripts/Pokemon/pokemon_data.gd" id="4_sv7pb"]
[ext_resource type="AudioStream" uid="uid://cc22l71itp88t" path="res://Assets/Music/battle_bgm.mp3" id="5_2ip8y"]
[ext_resource type="Script" uid="uid://1a01b2vud68f" path="res://Scripts/Music/bgm.gd" id="6_vtehv"]
[ext_resource type="Texture2D" uid="uid://dtrlb60po3mlt" path="res://SpriteSheets/battle-arena.png" id="7_loea4"]

[node name="CombatScene" type="Node2D"]

[node name="CombatManager" parent="." node_paths=PackedStringArray("combat_ui", "player", "enemy") instance=ExtResource("4_loea4")]
combat_ui = NodePath("../CombatPlayerUI")
player = NodePath("../PlayerCharacter")
enemy = NodePath("../EnemyCharacter")

[node name="BattleArena" type="Sprite2D" parent="."]
position = Vector2(573.99994, 325.5)
scale = Vector2(4.8, 5.784)
texture = ExtResource("7_loea4")
region_enabled = true
region_rect = Rect2(250, 0, 240, 125)

[node name="PlayerCharacter" parent="." instance=ExtResource("2_2ip8y")]
position = Vector2(260, 555)
scale = Vector2(6, 6)
poke_resources = Array[ExtResource("4_sv7pb")]([null])

[node name="EnemyCharacter" parent="." instance=ExtResource("3_vtehv")]
position = Vector2(824, 294)
scale = Vector2(6, 6)

[node name="CombatPlayerUI" parent="." instance=ExtResource("1_7uj85")]

[node name="BGM" type="AudioStreamPlayer2D" parent="."]
stream = ExtResource("5_2ip8y")
autoplay = true
script = ExtResource("6_vtehv")

[connection signal="battle_log_choser_added" from="CombatManager" to="CombatPlayerUI" method="update_log"]
[connection signal="battle_log_critical_added" from="CombatManager" to="CombatPlayerUI" method="update_log"]
[connection signal="battle_log_damage_added" from="CombatManager" to="CombatPlayerUI" method="update_log"]
[connection signal="battle_log_heal_added" from="CombatManager" to="CombatPlayerUI" method="update_log"]
[connection signal="battle_log_miss_added" from="CombatManager" to="CombatPlayerUI" method="update_log"]
[connection signal="enemy_hit" from="CombatManager" to="EnemyCharacter" method="take_damage"]
[connection signal="execute_enemy_turn" from="CombatManager" to="PlayerCharacter" method="update_hp"]
[connection signal="execute_enemy_turn" from="CombatManager" to="EnemyCharacter" method="update_hp"]
[connection signal="execute_player_turn" from="CombatManager" to="PlayerCharacter" method="update_hp"]
[connection signal="execute_player_turn" from="CombatManager" to="EnemyCharacter" method="update_hp"]
[connection signal="execute_player_turn" from="CombatManager" to="CombatPlayerUI" method="player_turn_start"]
[connection signal="player_death" from="CombatManager" to="CombatPlayerUI" method="player_pokemon_death"]
[connection signal="player_hit" from="CombatManager" to="PlayerCharacter" method="take_damage"]
[connection signal="victory_signal" from="CombatManager" to="CombatPlayerUI" method="player_victory"]
[connection signal="active_player_pokemon" from="PlayerCharacter" to="CombatPlayerUI" method="update_active_pokemon"]
[connection signal="all_player_pokemon" from="PlayerCharacter" to="CombatPlayerUI" method="initialise_pokemon_instances"]
[connection signal="combat_end" from="CombatPlayerUI" to="PlayerCharacter" method="update_hp"]
[connection signal="combat_end" from="CombatPlayerUI" to="EnemyCharacter" method="update_hp"]
[connection signal="combat_end" from="CombatPlayerUI" to="BGM" method="_on_combat_player_ui_combat_end"]
[connection signal="item_to_use" from="CombatPlayerUI" to="CombatManager" method="use_item"]
[connection signal="update_hp_on_pokemon_death" from="CombatPlayerUI" to="PlayerCharacter" method="update_hp"]
[connection signal="update_hp_on_pokemon_death" from="CombatPlayerUI" to="EnemyCharacter" method="update_hp"]
